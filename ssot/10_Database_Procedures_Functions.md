# 📋 Database Procedures & Functions 정책

## 🎯 개요

데이터베이스 저장 프로시저와 함수의 **자동 추출, 문서화, 관리 정책**을 정의합니다.

## 📁 파일 구조

```
libs/database/src/procedures/
├── procedures/          # 저장 프로시저 SQL 파일들
├── functions/           # 함수 SQL 파일들
└── *.sql               # 개별 프로시저/함수 파일들
```

## 🔄 자동 생성 정책

### 파일 명명 규칙

- **프로시저**: `{procedure_name}.sql`
- **함수**: `{function_name}.sql`
- **모두 소문자**로 생성

### 파일 내용 구조

```sql
-- ================================================================
-- PROCEDURE: procedure_name
-- ================================================================
--
-- Description: 프로시저 설명
--
-- Parameters:
--   IN param1 VARCHAR(100)
--   OUT param2 INT
--
-- Created: 2025-09-13T08:58:50.000Z
-- Modified: 2025-09-13T08:58:50.000Z
-- Environment: dev
-- Database: public
--
-- Generated by: Enhanced DB Schema Analyzer
-- ================================================================

DELIMITER $$

CREATE PROCEDURE `procedure_name`(...)
BEGIN
    -- 프로시저 본문
END$$

DELIMITER ;
```

## 📚 문서 생성 정책

### ❌ 제거된 문서들

다음 문서들은 **SSOT 정책에 따라 제거**됩니다:

- `libs/database/src/procedures/README.md`
- `libs/database/src/procedures/docs/index.md`
- `libs/database/src/procedures/docs/procedures.md`
- `libs/database/src/procedures/docs/functions.md`

### ✅ 통합 문서 정책

- **모든 문서는 SSOT 폴더에서 관리**
- **실제 SQL 파일만** `libs/database/src/procedures/`에 보관
- **문서와 정책은 SSOT에서 중앙 관리**

## 🚀 사용법

### 프로시저 호출

```sql
CALL procedure_name(param1, param2);
```

### 함수 사용

```sql
SELECT function_name(param1) AS result FROM table_name;
```

### 파일 임포트

```bash
# 모든 프로시저 임포트
mysql -u username -p database_name < libs/database/src/procedures/procedures/*.sql

# 특정 프로시저 임포트
mysql -u username -p database_name < libs/database/src/procedures/procedure_name.sql
```

## 🔧 재생성 방법

```bash
# DB 동기화 실행 (프로시저 포함)
npm run db:sync

# 프로시저만 수동 추출
ts-node scripts/db-analyzer/procedure-extractor.ts schema.json
```

## ⚠️ 중요 사항

1. **자동 생성**: 모든 파일은 DB에서 자동 추출됨
2. **환경별 관리**: dev/qa/prod 환경별로 다를 수 있음
3. **백업 권장**: 프로덕션 적용 전 반드시 백업
4. **의존성 주의**: 일부 프로시저/함수는 서로 의존관계가 있을 수 있음
5. **수동 편집 금지**: 생성된 파일을 수동으로 편집하지 말 것

## 🎯 현재 상태 (dev 환경)

- **저장 프로시저**: 6개
- **함수**: 5개
- **마지막 업데이트**: 자동 생성 시점

### 주요 프로시저/함수 목록

- `generate_keywords` - 키워드 생성 프로시저
- `sp_hello_world1~5` - 테스트용 프로시저들
- `fn_hello_world1~5` - 테스트용 함수들

---

> 📝 **정책 문서**: 이 문서는 SSOT(Single Source of Truth) 정책에 따라 중앙에서 관리됩니다.
